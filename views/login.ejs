<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Marks Secured · Login</title>
  <link rel="stylesheet" href="/public/css/main.css">
  <script defer src="/public/js/main.js"></script>

  <!-- Invalid-credentials modal styles (minimal, won't clash with your main.css) -->
  <style>
    /* Modal overlay */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 16px;
    }

    /* Modal box */
    .modal-box {
      background: #fff;
      max-width: 480px;
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 20px;
      font-family: inherit;
    }

    .modal-title {
      font-size: 18px;
      margin: 0 0 8px;
      color: #222;
    }

    .modal-text {
      margin: 0 0 16px;
      color: #444;
      line-height: 1.4;
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .modal-btn {
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid transparent;
      background: #f3f3f3;
    }

    .modal-btn.primary {
      background: #0b69ff;
      color: #fff;
      border-color: rgba(11,105,255,0.9);
    }

    /* show the overlay when .open is applied */
    .modal-overlay.open { display: flex; }
  </style>
</head>
<body>
  <header class="header">
    <div class="topbar">
      <div class="brand">
        <img src="/public/img/logo.svg" alt="logo">
        <div class="title">CAREERS</div>
      </div>
      <nav class="nav" aria-label="Primary">
        <a href="/">HOME</a><a href="#">JOIN SBI</a><a href="#">WHY SBI</a>
      </nav>
      <a class="contact-btn" href="#">CONTACT US</a>
    </div>
  </header>

  <div class="wrapper">
    <img src="/public/img/banner-login.svg" alt="" style="width:100%;border-radius:12px;margin-bottom:16px">
    <div class="card">
      <h2 style="margin:0 0 8px">Recruitment of Junior Associates (Customer Support & Sales) in SBI</h2>
      <p class="lead" style="margin-top:2px">(Main Examination held on 10th & 12th APRIL 2025) — Marks Secured by the Candidate</p>

      <form action="/login" method="post" style="margin-top:10px">
        <div class="form-row">
          <div style="flex:1 1 260px">
            <label class="label">Roll Number or Registration Number</label>
            <input class="input" name="id" placeholder="Roll No or Reg No" required>
          </div>
          <div style="flex:1 1 260px">
            <label class="label">Date of Birth</label>
            <input class="input" name="dob" placeholder="dd-mm-yyyy" required>
          </div>
        </div>

        <div class="form-row" style="align-items:center;margin-top:8px">
          <div class="label" style="margin:0">Text Verification</div>
        </div>
        <div class="form-row" style="align-items:center">
          <div class="captcha" id="captchaBox"><%= captcha %></div>
          <button type="button" id="refreshCaptcha" class="btn btn-secondary">Refresh</button>
          <input class="input" name="captcha" placeholder="Type characters shown above" required style="flex:1">
        </div>

        <div style="margin-top:14px;display:flex;gap:10px">
          <button class="btn btn-primary" type="submit">SUBMIT</button>
          <button class="btn btn-secondary" type="reset">RESET</button>
        </div>
      </form>
    </div>
  </div>

  <div class="footer">© Careers Portal.</div>

  <!-- Invalid credentials modal (hidden by default) -->
  <div id="invalidModalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="invalidModalTitle">
    <div class="modal-box" role="document">
      <h3 id="invalidModalTitle" class="modal-title">Invalid Credentials</h3>
      <p id="invalidModalText" class="modal-text">The Roll Number / Registration Number or Date of Birth you entered is incorrect. Please check and try again.</p>
      <div class="modal-actions">
        <button id="invalidModalOk" class="modal-btn primary" type="button">OK</button>
      </div>
    </div>
  </div>

  <!-- Modal show/close script -->
  <script>
    (function () {
      const overlay = document.getElementById('invalidModalOverlay');
      const okBtn = document.getElementById('invalidModalOk');
      const modalText = document.getElementById('invalidModalText');

      function showInvalidModal(message) {
        if (message) modalText.textContent = message;
        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden', 'false');
        okBtn.focus();
      }

      function closeInvalidModal() {
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
      }

      okBtn.addEventListener('click', closeInvalidModal);
      overlay.addEventListener('click', function (e) {
        if (e.target === overlay) closeInvalidModal();
      });

      // Close on Escape
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && overlay.classList.contains('open')) closeInvalidModal();
      });

      // --- How modal is triggered ---
      // Option 1 (recommended): server sets `invalid` (boolean) and optional `invalidMessage`
      // when rendering this EJS template. Example in Node/Express:
      // res.render('login', { captcha, invalid: true, invalidMessage: 'Wrong credentials' });
      //
      // Option 2: if you prefer to use a query param like ?error=1, keep below fallback:
      //
      // The EJS checks below will call showInvalidModal on page load if `invalid` or
      // `invalidMessage` is passed from server.

      document.addEventListener('DOMContentLoaded', function () {
        /* EJS-driven show: server should pass `invalid` (true) and optional `invalidMessage` */
        <% if (typeof invalid !== 'undefined' && invalid) { %>
          showInvalidModal(<%- JSON.stringify(typeof invalidMessage !== 'undefined' && invalidMessage ? invalidMessage : 'Invalid credentials. Please try again.') %>);
        <% } else { %>
          // Fallback: check query param `error=invalid` (works if you redirect to /login?error=invalid)
          (function () {
            try {
              const params = new URLSearchParams(window.location.search);
              if (params.get('error') === 'invalid') {
                const msg = params.get('msg') || 'Invalid credentials. Please try again.';
                showInvalidModal(msg);
              }
            } catch (e) { /* ignore on older browsers */ }
          })();
        <% } %>
      });
    })();
  </script>
</body>
</html>
